name: Check QA

on: push

jobs:
  blackduck:
    name: Run Black Duck Scan
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'

      - name: Build with Maven
        id: build
        run: mvn clean install -DskipTests

      - name: Black Duck Full Scan
        uses: synopsys-sig/synopsys-action@v1.13.0
        env:
          DETECT_PROJECT_NAME: SKO-Connect_Services-Backend
          DETECT_ACCURACY_REQUIRED: "NONE"
        with:
          blackduck_url: ${{ secrets.BLACKDUCK_URL }}
          blackduck_token: ${{ secrets.BLACKDUCK_TOKEN }}
          blackduck_scan_full: true
          # Uses current branch as a version name
          blackduck_args: "--detect.project.version.name=${{ github.ref_name }}"
          # Fails this job depending on severity level (BLOCKER,CRITICAL,MAJOR,MINOR,TRIVIAL)
          blackduck_scan_failure_severities: 'BLOCKER,CRITICAL,MAJOR'
          # Creates pull requests with upgrade suggestions for vulnerable components, currently only npm supported
          blackduck_fixpr_enabled: false


#  sonarqube:
#    name: Run SonarQube Scan
#    runs-on: ubuntu-latest
#    needs: build
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v4
#
#      - name: SonarCloud Scan
#        uses: sonarsource/sonarcloud-github-action@v3
#        env:
#          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

#      - name: Run SonarQube Scanner
#        run: |
#          mvn sonar:sonar \
#            -Dsonar.projectKey=my-spring-app \
#            -Dsonar.host.url=${{ secrets.SONAR_URL }} \
#            -Dsonar.login=${{ secrets.SONAR_TOKEN }}
